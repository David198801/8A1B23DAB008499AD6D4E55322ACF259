作者：灵剑

链接：https://www.zhihu.com/question/51438786/answer/125920692

来源：知乎

著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。



socket通信的双方自己决定自己要用什么端口，服务器端只能决定自己listen的是哪个端口，不能决定客户端的端口；客户端也只能决定自己的端口，当然，因为它是主动连接的，所以它知道对方的端口号，但它也不能把对方的服务移到别的端口上面去。端口号是用来区分相同主机上的不同socket的，它相当于socket在本机这一端的名字，你去邮局寄信给别人，收件人总不能改你名字吧？

客户端实际上是可以为自己绑定一个特定的端口号的，只要在connect之前先进行bind就行了：

```javascript
from socket import socket

s = socket()
s.bind(('', 9999))
s.connect(('10.1.2.3', 80))
...
```

但是一般来说没有人实际这样做，首先一个端口只能bind一次，占用了之后同时就不能再给别人用了，这么宝贵的资源都要留给listen的一方，主动连接的一方一般去用那些操作系统随机分配的端口号。

bind也可以指定端口号为0，这种情况下就是随机绑定一个没有使用过的端口号，可以用来在建立连接之前就确定本端的端口号。某些情况下还是有用的，设想某种网络环境下，我们需要在建立连接之前主动去申请防火墙通过，就可以考虑先进行bind，否则连接建立不起来（不过会有这么傻的设备吗……）

作为listen的一方，所有被动建立起来的连接的本端端口都是listen的端口。只有源IP、源端口、目的IP、目的端口还有协议号都完全相同才会认为是同一个socket，所以被动建立连接的socket源端口号不同，目的端口号是可以相同的。